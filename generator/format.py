MODULE_TEMPLATE = """\"\"\"
This file is generated by generator/run.py with chrome-devtools-protocol.

{description}
https://chromedevtools.github.io/devtools-protocol/tot/{domain}/

***************************************************
                    {hints}
***************************************************
\"\"\"
from __future__ import annotations

import enum
from typing import Any, Literal
from cdpkit.protocol.base import CDPObject, InputModel, OutputModel, CDPEvent, CDPMethod, JSON_DICT
{ref_imports}

{main_code}
"""


COMMON_TYPES_MODULE_TEMPLATE = """\"\"\"
This file is generated by generator/run.py with chrome-devtools-protocol.

All domain types in this module:
    In order to solve all the problems of importing from each other, all types are stored here
\"\"\"

from __future__ import annotations

import enum
from typing import Any, Literal
from cdpkit.protocol.base import CDPObject, JSON_DICT

{types_code}

{types_for_class}
"""

CLASS_TEMPLATE = """
class {class_name}{parent}:{tips}
{description}
{properties}
{functions}
"""

PROPERTY_TEMPLATE = """{name}{hint}{value}{tips}"""


def make_class(
    class_name: str,
    parent: str = '',
    tips: str = '',
    description: str = '',
    properties: str = '',
    functions: str = '',
) -> str:
    return CLASS_TEMPLATE.format(
        class_name=class_name,
        parent=f'({parent})' if parent else '',
        tips=f'  # {tips}' if tips else '',
        description=description,
        properties=properties,
        functions=functions,
    )


def make_property(
    name: str,
    hint: str | None = None,
    value: str | None = None,
    tips: str | None = None
) -> str:
    return PROPERTY_TEMPLATE.format(
        name=name,
        hint=f': {hint}' if hint else '',
        value=f' = {value}' if value else '',
        tips=f'  # {tips}' if tips else '',
    )


def make_ref_imports(
    ref_imports: set | None = None
) -> str:
    if ref_imports:
        return f'from cdpkit.protocol._types import (\n    {"    ".join([f'{_}, \n' for _ in ref_imports])})'
    return ''


def make_methods_init(
    init_input_properties: str,
    init_super_use_properties: str
):
    if init_input_properties and init_super_use_properties:
        return f"""
    def __init__(
        self,
        /,
        *,
{init_input_properties}
    ):
        super().__init__(
{init_super_use_properties}
        )
        """
    return ''


def make_common_types_module(
    types_code: str,
    types_for_class: str,
) -> str:
    return COMMON_TYPES_MODULE_TEMPLATE.format(
        types_code=types_code,
        types_for_class=types_for_class
    )


def make_module(
    domain: str,
    description: str,
    ref_imports: str,
    main_code: str,
    hints: str
):
    return MODULE_TEMPLATE.format(
        domain=domain,
        description=description,
        hints=hints.title(),
        ref_imports=ref_imports,
        main_code=main_code
    )
